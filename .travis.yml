dist: xenial
language: python

python:
- '3.7'

services:
  - docker

install:
- pip install -r requirements.txt
- pip install -r requirements-test.txt
- pip install mkdocs mkdocs-material

cache: pip

script:
- black local_data_api tests --check --skip-string-normalization
- mypy --ignore-missing-imports --disallow-untyped-defs local_data_api
- nosetests -v --with-coverage --cover-package=local_data_api --cover-erase tests
- isort --recursive --check-only -w 100 --thirdparty local_data_api local_data_api tests -m 3 -tc
- pytest --cov=local_data_api tests
- cp README.md docs/index.md && mkdocs build --verbose --clean --strict
after_success:
- codecov
deploy:
  - provider: script
    script: bash scripts/push-image.sh
    on:
      tags: true
  - provider: pages
    skip_cleanup: true
    github_token: $GITHUB_TOKEN
    local_dir: site
    on:
      branch: master
